!function t(e,s,a){function i(r,n){if(!s[r]){if(!e[r]){var o="function"==typeof require&&require;if(!n&&o)return o(r,!0);if(l)return l(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var u=s[r]={exports:{}};e[r][0].call(u.exports,(function(t){return i(e[r][1][t]||t)}),u,u.exports,t,e,s,a)}return s[r].exports}for(var l="function"==typeof require&&require,r=0;r<a.length;r++)i(a[r]);return i}({1:[function(t,e,s){e.exports={TasksCreation:class{constructor(){$("#task-creation-form").submit(t=>{t.preventDefault(),this._addTask()})}_addTask(){WAIT_SCREEN.enable();let t=new FormData($("#task-creation-form")[0]);$.ajax({url:URLS.create_task,data:JSON.stringify(Object.fromEntries(t.entries())),type:"POST",contentType:"application/json"}).done(t=>{$("#tasks-stack-items").trigger({type:"addTask",taskData:t})}).fail((t,e,s)=>{console.log("jqXHR",t)}).always(()=>{WAIT_SCREEN.disable()})}}}},{}],2:[function(t,e,s){class a{constructor(t){this._activeValues=[];for(let[e,s]of t.entries){let a=document.createElement("div");$(t.dialogWindowId+" > .dialog-window-content").append(a);let i=`filter-checkbox-${t.filterName}-${e}`.toLowerCase(),l=document.createElement("input");$(l).attr("type","checkbox"),$(l).attr("id",i),$(l).attr("value",e),$(l).addClass("styled-checkbox"),$(l).on("change",s=>{$(l).prop("checked")?this._activeValues.includes(e)||this._activeValues.push(e):this._activeValues=this._activeValues.filter(t=>t!=e),$("#tasks-stack-items").trigger({type:"setFilter",name:t.filterName,values:this._activeValues})}),$(t.dialogWindowId).on(t.filterEventName,t=>{$(l).prop("checked",t.activeValues.includes(e))}),$(a).append(l);let r=document.createElement("label");$(r).attr("for",i),$(a).append(r);let n=document.createElement("div");$(n).addClass(this._getItemClasses(e)),$(n).text(s),$(n).on("click",t=>{$(l).click()}),$(a).append(n)}$(t.dialogWindowId).on(t.filterEventName,e=>{$(t.dialogWindowId).addClass("dialog-window-open"),this._activeValues=e.activeValues})}_getItemClasses(t){}}e.exports={TasksStatusChangingDialog:class{constructor(){this._taskItem=null;for(let[t,e]of Object.entries(CHOISES.task.status)){let s=document.createElement("div");$(s).addClass(["change-status-dialog-item","tasks-stack-item-status","tasks-stack-item-status-"+t.toLowerCase()].join(" ")),$(s).text(e),$(s).on("click",e=>{this._changeValue(t)}),$("#change-status-dialog > .dialog-window-content").append(s)}$("#change-status-dialog").on("click",t=>{this._taskItem=null}),$("#change-status-dialog").on("changeStatusStart",t=>{$("#change-status-dialog").addClass("dialog-window-open"),this._taskItem=t.taskItem})}_changeValue(t){this._taskItem&&(WAIT_SCREEN.enable(),$.ajax({url:URLS.update_task.replace(/\d+\/$/,this._taskItem.id+"/"),data:JSON.stringify({status:t}),type:"PATCH",contentType:"application/json"}).done(e=>{this._taskItem.status.value=t}).fail((t,e,s)=>{console.log("jqXHR",t)}).always(()=>{this._taskItem=null,WAIT_SCREEN.disable()}),$("#change-status-dialog").removeClass("dialog-window-open"))}},TasksStatusFilterDialog:class extends a{constructor(){super({entries:Object.entries(CHOISES.task.status),dialogWindowId:"#filter-status-dialog",filterName:"status",filterEventName:"filterStatusStart"})}_getItemClasses(t){return["filter-status-dialog-item","tasks-stack-item-status","tasks-stack-item-status-"+t.toLowerCase()].join(" ")}},TasksPriorityFilterDialog:class extends a{constructor(){super({entries:Object.entries(CHOISES.task.priority).reverse().map(([t,e])=>[parseInt(t),e]),dialogWindowId:"#filter-priority-dialog",filterName:"priority",filterEventName:"filterPriorityStart"})}_getItemClasses(t){return["filter-priority-dialog-item","tasks-stack-item-priority-"+t].join(" ")}}}},{}],3:[function(t,e,s){const{TasksStack:a}=t("./stack"),{TasksStatusChangingDialog:i,TasksStatusFilterDialog:l,TasksPriorityFilterDialog:r}=t("./dialog"),{TasksCreation:n}=t("./creation");window.CHOISES=JSON.parse(RAW_CHOISES),window.URLS=JSON.parse(RAW_URLS),window.WAIT_SCREEN={enabled:!1,enable(){$("#wait-screen").addClass("wait-screen-enabled"),this.enabled=!0},disable(){$("#wait-screen").removeClass("wait-screen-enabled"),this.enabled=!1}},$.ajaxSetup({beforeSend:function(t,e){if(/^(GET|HEAD|OPTIONS|TRACE)$/.test(e.type)||this.crossDomain)return;let s=document.cookie.split("csrftoken=")[1].split("; ")[0];t.setRequestHeader("X-CSRFToken",s)}}),$(document).ready((function(){new a,new i,new l,new r,new n,$(".dialog-window").on("click",(function(t){$(this).removeClass("dialog-window-open")})),$(".dialog-window-content").on("click",(function(t){t.stopPropagation()}))}))},{"./creation":1,"./dialog":2,"./stack":4}],4:[function(t,e,s){class a{constructor(t,e){this._item=t,this._value=null;let s=document.createElement("div");$(s).addClass("tasks-stack-cell tasks-stack-cell-priority"),$(this._item.element).append(s),this._valueElement=document.createElement("div"),$(s).append(this._valueElement),this.value=e}get value(){return this._value}set value(t){if(!Object.keys(CHOISES.task.priority).includes(t.toString()))throw Error(`Wrong task priority value "${t}".`);this._value=t,$(this._valueElement).attr("title",CHOISES.task.priority[t]).removeClass().addClass(["tasks-stack-item-priority","tasks-stack-item-priority-"+t].join(" "))}}class i{constructor(t,e){this._wrapper=t,this._value=null,this._valueElement=document.createElement("div"),$(this._valueElement).addClass("tasks-stack-cell-meaning-name"),$(this._wrapper.element).append(this._valueElement),this.value=e}get value(){return this._value}set value(t){this._value=t,$(this._valueElement).text(t)}}class l{constructor(t,e){this._wrapper=t,this._value=null,this._valueElement=document.createElement("div"),$(this._valueElement).addClass("tasks-stack-cell-meaning-description"),$(this._valueElement).append("<div>i</div>"),$(this._wrapper.element).append(this._valueElement),this.value=e}get value(){return this._value}set value(t){this._value=t,t&&""!=t?($(this._valueElement).addClass("tasks-stack-cell-meaning-description-show"),$(this._valueElement).attr("title",t)):($(this._valueElement).removeClass("tasks-stack-cell-meaning-description-show"),$(this._valueElement).attr("title",""))}}class r{constructor(t,e,s){this._item=t;let a=document.createElement("div");$(a).addClass("tasks-stack-cell tasks-stack-cell-meaning"),$(this._item.element).append(a),this.element=document.createElement("div"),$(this.element).addClass("tasks-stack-cell-meaning-wrapper"),$(a).append(this.element),this._name=new i(this,e),this._decsription=new l(this,s)}get name(){return this._name}get decsription(){return this._decsription}}class n{constructor(t,e){this._item=t,this._value=null;let s=document.createElement("div");$(s).addClass("tasks-stack-cell tasks-stack-cell-status"),$(this._item.element).append(s),this._valueElement=document.createElement("div"),$(this._valueElement).on("click",t=>{$("#change-status-dialog").trigger({type:"changeStatusStart",taskItem:this._item})}),$(s).append(this._valueElement),this.value=e}get value(){return this._value}set value(t){if(!Object.keys(CHOISES.task.status).includes(t))throw Error(`Wrong task status value "${t}".`);this._value=t,$(this._valueElement).text(CHOISES.task.status[t]).removeClass().addClass(["tasks-stack-item-status","tasks-stack-item-status-"+t.toLowerCase()].join(" "))}}class o{static FILTERED_DATA_NAMES=["priority","status"];constructor(t){this.element=document.createElement("div"),$(this.element).addClass("tasks-stack-row"),this.id=t.id,this._taskData=t,this._priority=null,this._meaning=null,this._status=null,this._fillContent()}_fillContent(){this._priority=new a(this,this._taskData.priority),this._meaning=new r(this,this._taskData.name,this._taskData.description),this._status=new n(this,this._taskData.status)}refreshContent(){$(this.element).empty(),this._fillContent()}get priority(){return this._priority}get name(){return this._meaning.name}get decsription(){return this._meaning.decsription}get status(){return this._status}}class c{constructor(){this._items={},this._filter={priority:Object.keys(CHOISES.task.priority).map(t=>parseInt(t)),status:Object.keys(CHOISES.task.status)},$("#tasks-stack-items").on("addTask",t=>{this._addTask(t.taskData),this._draw()}),$("#tasks-stack-items").on("setFilter",t=>{this._setFilter(t.name,t.values)}),$("#tasks-stack-filter-status").on("click",t=>{$("#filter-status-dialog").trigger({type:"filterStatusStart",activeValues:this._filter.status})}),$("#tasks-stack-filter-priority").on("click",t=>{$("#filter-priority-dialog").trigger({type:"filterPriorityStart",activeValues:this._filter.priority})}),this._getTasksData()}*[Symbol.iterator](){let t=this._sortItems(this._filterItems(Object.values(this._items)));for(let e of t)yield e}_filterItems(t){for(let e of Object.keys(this._filter))t=t.filter(t=>this._filter[e].includes(t[e].value));return t}_sortItems(t){return t.sort((t,e)=>t.priority.value>e.priority.value?-1:t.priority.value<e.priority.value?1:0)}_addTask(t){this._items[t.id]=new o(t)}_draw(){$("#tasks-stack-items").empty();for(let t of this)$("#tasks-stack-items").append(t.element),t.refreshContent()}_getTasksData(){$.ajax({url:URLS.user_tasks}).done(t=>{for(let e of t)this._addTask(e);this._draw()}).fail((function(t,e,s){console.log("jqXHR",t)}))}_setFilter(t,e){if(!o.FILTERED_DATA_NAMES.includes(t))throw Error(`Wrong stack item data name "${t}".`);if(!Array.isArray(e))throw Error("Values argument has to be an array.");this._filter[t]=e,this._draw()}}e.exports={TasksStack:c}},{}]},{},[3]);