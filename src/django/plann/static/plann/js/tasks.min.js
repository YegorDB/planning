!function t(e,s,a){function i(r,l){if(!s[r]){if(!e[r]){var o="function"==typeof require&&require;if(!l&&o)return o(r,!0);if(n)return n(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var u=s[r]={exports:{}};e[r][0].call(u.exports,(function(t){return i(e[r][1][t]||t)}),u,u.exports,t,e,s,a)}return s[r].exports}for(var n="function"==typeof require&&require,r=0;r<a.length;r++)i(a[r]);return i}({1:[function(t,e,s){
/*!
  Copyright (c) 2018 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/
!function(){"use strict";var t={}.hasOwnProperty;function s(){for(var e=[],a=0;a<arguments.length;a++){var i=arguments[a];if(i){var n=typeof i;if("string"===n||"number"===n)e.push(i);else if(Array.isArray(i)){if(i.length){var r=s.apply(null,i);r&&e.push(r)}}else if("object"===n)if(i.toString===Object.prototype.toString)for(var l in i)t.call(i,l)&&i[l]&&e.push(l);else e.push(i.toString())}}return e.join(" ")}void 0!==e&&e.exports?(s.default=s,e.exports=s):"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("classnames",[],(function(){return s})):window.classNames=s}()},{}],2:[function(t,e,s){e.exports={TasksCreation:class{constructor(){$("#task-creation-form").submit(t=>{t.preventDefault(),this._addTask()})}_addTask(){WAIT_SCREEN.enable();let t=new FormData($("#task-creation-form")[0]);$.ajax({url:URLS.create_task,data:JSON.stringify(Object.fromEntries(t.entries())),type:"POST",contentType:"application/json"}).done(t=>{$("#tasks-stack-items").trigger({type:"addTask",taskData:t})}).fail((t,e,s)=>{console.log("jqXHR",t)}).always(()=>{WAIT_SCREEN.disable()})}}}},{}],3:[function(t,e,s){const a=t("classnames");class i extends React.Component{constructor(t){super(t),this.state={opened:!1}}get items(){return[]}get openFunction(){return t=>{this.setState({opened:!0}),this.openAdditionalFunction(t)}}get openAdditionalFunction(){return t=>{}}get closeFunction(){return t=>{this.setState({opened:!1}),this.closeAdditionalFunction(t)}}get closeAdditionalFunction(){return t=>{}}render(){let t=a("dialog-window",{"dialog-window-open":this.state.opened});return React.createElement("div",{className:t,onClick:this.closeFunction},React.createElement("div",{className:"dialog-window-content",onClick:t=>{t.stopPropagation()}},this.items))}}class n extends i{static FILTER_NAME=null;static FILTER_EVENT_NAME=null;constructor(t){super(t),this._entries=this._getEntries(t.choices),this.state={...this.state,activeValues:Object.keys(t.choices)},$(document).on(this.constructor.FILTER_EVENT_NAME,this.openFunction)}get openAdditionalFunction(){return t=>{this.setState({activeValues:t.activeValues})}}get items(){return this._entries.map(([t,e])=>{let s=`filter-checkbox-${this.constructor.FILTER_NAME}-${t.toString().toLowerCase()}`;return React.createElement("div",{key:t},React.createElement("input",{type:"checkbox",id:s,value:t,onChange:this._getItemChangeHandler(s,t),checked:this.state.activeValues.includes(t),className:"styled-checkbox"}),React.createElement("label",{htmlFor:s}),React.createElement("div",{className:this._getItemClasses(t),onClick:this._getItemClickHandler(s)},e))})}_getEntries(t){return Object.entries(t)}_getItemClasses(t){}_getItemClickHandler(t){return e=>{$(`#${t} + label`).click()}}_getItemChangeHandler(t,e){return t=>{t.target.checked?this.state.activeValues.includes(e)||this.setState((t,s)=>{let a=[...t.activeValues,e];return this._trigerSetFilterEvent(a),{activeValues:a}}):this.setState((t,s)=>{let a=t.activeValues.filter(t=>t!=e);return this._trigerSetFilterEvent(a),{activeValues:a}})}}_trigerSetFilterEvent(t){$("#tasks-stack-items").trigger({type:"setFilter",name:this.constructor.FILTER_NAME,values:t})}}e.exports={TaskStatusChangingDialogComponent:class extends i{constructor(t){super(t),this._taskItem=null,$(document).on("changeStatusStart",this.openFunction)}get items(){return Object.entries(CHOISES.task.status).map(([t,e])=>{let s=a("tasks-stack-change-status-dialog-item","tasks-stack-item-status","tasks-stack-item-status-"+t.toLowerCase());return React.createElement("div",{className:s,onClick:e=>{this._changeValue(t)},key:t},e)})}get openAdditionalFunction(){return t=>{this._taskItem=t.taskItem}}get closeAdditionalFunction(){return t=>{this._taskItem=null}}_changeValue(t){this._taskItem&&(WAIT_SCREEN.enable(),$.ajax({url:URLS.update_task.replace(/\d+\/$/,this._taskItem.id+"/"),data:JSON.stringify({status:t}),type:"PATCH",contentType:"application/json"}).done(e=>{this._taskItem.status.value=t}).fail((t,e,s)=>{console.log("jqXHR",t)}).always(()=>{this._taskItem=null,WAIT_SCREEN.disable()}),this.setState({opened:!1}))}},TaskStatusFilterDialogComponent:class extends n{static FILTER_NAME="status";static FILTER_EVENT_NAME="filterStatusStart";_getItemClasses(t){return a("tasks-stack-filter-status-dialog-item","tasks-stack-item-status","tasks-stack-item-status-"+t.toLowerCase())}},TaskPriorityFilterDialogComponent:class extends n{static FILTER_NAME="priority";static FILTER_EVENT_NAME="filterPriorityStart";_getEntries(t){return Object.entries(t).reverse().map(([t,e])=>[parseInt(t),e])}_getItemClasses(t){return a("tasks-stack-filter-priority-dialog-item","tasks-stack-item-priority-"+t)}}}},{classnames:1}],4:[function(t,e,s){const{TasksStack:a}=t("./stack"),{TaskStatusChangingDialogComponent:i,TaskStatusFilterDialogComponent:n,TaskPriorityFilterDialogComponent:r}=t("./dialog.jsx"),{TasksCreation:l}=t("./creation");window.CHOISES=JSON.parse(RAW_CHOISES),window.URLS=JSON.parse(RAW_URLS),window.WAIT_SCREEN={enabled:!1,enable(){$("#wait-screen").addClass("wait-screen-enabled"),this.enabled=!0},disable(){$("#wait-screen").removeClass("wait-screen-enabled"),this.enabled=!1}},$.ajaxSetup({beforeSend:function(t,e){if(/^(GET|HEAD|OPTIONS|TRACE)$/.test(e.type)||this.crossDomain)return;let s=document.cookie.split("csrftoken=")[1].split("; ")[0];t.setRequestHeader("X-CSRFToken",s)}}),$(document).ready((function(){new a,new l,ReactDOM.render(React.createElement(i,null),document.getElementById("change-status-dialog")),ReactDOM.render(React.createElement(n,{choices:CHOISES.task.status}),document.getElementById("filter-status-dialog")),ReactDOM.render(React.createElement(r,{choices:CHOISES.task.priority}),document.getElementById("filter-priority-dialog"))}))},{"./creation":2,"./dialog.jsx":3,"./stack":5}],5:[function(t,e,s){class a{constructor(t,e){this._item=t,this._value=null;let s=document.createElement("div");$(s).addClass("tasks-stack-cell tasks-stack-cell-priority"),$(this._item.element).append(s),this._valueElement=document.createElement("div"),$(s).append(this._valueElement),this.value=e}get value(){return this._value}set value(t){if(!Object.keys(CHOISES.task.priority).includes(t.toString()))throw Error(`Wrong task priority value "${t}".`);this._value=t,$(this._valueElement).attr("title",CHOISES.task.priority[t]).removeClass().addClass(["tasks-stack-item-priority","tasks-stack-item-priority-"+t].join(" "))}}class i{constructor(t,e){this._wrapper=t,this._value=null,this._valueElement=document.createElement("div"),$(this._valueElement).addClass("tasks-stack-cell-meaning-name"),$(this._wrapper.element).append(this._valueElement),this.value=e}get value(){return this._value}set value(t){this._value=t,$(this._valueElement).text(t)}}class n{constructor(t,e){this._wrapper=t,this._value=null,this._valueElement=document.createElement("div"),$(this._valueElement).addClass("tasks-stack-cell-meaning-description"),$(this._valueElement).append("<div>i</div>"),$(this._wrapper.element).append(this._valueElement),this.value=e}get value(){return this._value}set value(t){this._value=t,t&&""!=t?($(this._valueElement).addClass("tasks-stack-cell-meaning-description-show"),$(this._valueElement).attr("title",t)):($(this._valueElement).removeClass("tasks-stack-cell-meaning-description-show"),$(this._valueElement).attr("title",""))}}class r{constructor(t,e,s){this._item=t;let a=document.createElement("div");$(a).addClass("tasks-stack-cell tasks-stack-cell-meaning"),$(this._item.element).append(a),this.element=document.createElement("div"),$(this.element).addClass("tasks-stack-cell-meaning-wrapper"),$(a).append(this.element),this._name=new i(this,e),this._decsription=new n(this,s)}get name(){return this._name}get decsription(){return this._decsription}}class l{constructor(t,e){this._item=t,this._value=null;let s=document.createElement("div");$(s).addClass("tasks-stack-cell tasks-stack-cell-status"),$(this._item.element).append(s),this._valueElement=document.createElement("div"),$(this._valueElement).on("click",t=>{$(document).trigger({type:"changeStatusStart",taskItem:this._item})}),$(s).append(this._valueElement),this.value=e}get value(){return this._value}set value(t){if(!Object.keys(CHOISES.task.status).includes(t))throw Error(`Wrong task status value "${t}".`);this._value=t,$(this._valueElement).text(CHOISES.task.status[t]).removeClass().addClass(["tasks-stack-item-status","tasks-stack-item-status-"+t.toLowerCase()].join(" "))}}class o{static FILTERED_DATA_NAMES=["priority","status"];constructor(t){this.element=document.createElement("div"),$(this.element).addClass("tasks-stack-row"),this.id=t.id,this._taskData=t,this._priority=null,this._meaning=null,this._status=null,this._fillContent()}_fillContent(){this._priority=new a(this,this._taskData.priority),this._meaning=new r(this,this._taskData.name,this._taskData.description),this._status=new l(this,this._taskData.status)}refreshContent(){$(this.element).empty(),this._fillContent()}get priority(){return this._priority}get name(){return this._meaning.name}get decsription(){return this._meaning.decsription}get status(){return this._status}}class c{constructor(){this._items={},this._filter={priority:Object.keys(CHOISES.task.priority).map(t=>parseInt(t)),status:Object.keys(CHOISES.task.status)},$("#tasks-stack-items").on("addTask",t=>{this._addTask(t.taskData),this._draw()}),$("#tasks-stack-items").on("setFilter",t=>{this._setFilter(t.name,t.values)}),$("#tasks-stack-filter-status").on("click",t=>{$(document).trigger({type:"filterStatusStart",activeValues:this._filter.status})}),$("#tasks-stack-filter-priority").on("click",t=>{$(document).trigger({type:"filterPriorityStart",activeValues:this._filter.priority})}),this._getTasksData()}*[Symbol.iterator](){let t=this._sortItems(this._filterItems(Object.values(this._items)));for(let e of t)yield e}_filterItems(t){for(let e of Object.keys(this._filter))t=t.filter(t=>this._filter[e].includes(t[e].value));return t}_sortItems(t){return t.sort((t,e)=>t.priority.value>e.priority.value?-1:t.priority.value<e.priority.value?1:0)}_addTask(t){this._items[t.id]=new o(t)}_draw(){$("#tasks-stack-items").empty();for(let t of this)$("#tasks-stack-items").append(t.element),t.refreshContent()}_getTasksData(){$.ajax({url:URLS.user_tasks}).done(t=>{for(let e of t)this._addTask(e);this._draw()}).fail((function(t,e,s){console.log("jqXHR",t)}))}_setFilter(t,e){if(!o.FILTERED_DATA_NAMES.includes(t))throw Error(`Wrong stack item data name "${t}".`);if(!Array.isArray(e))throw Error("Values argument has to be an array.");this._filter[t]=e,this._draw()}}e.exports={TasksStack:c}},{}]},{},[4]);